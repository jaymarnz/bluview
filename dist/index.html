<!DOCTYPE html><html><head><title>BluView: Display for BluOS Streamers</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon sizes=32x32 href=favicon-32x32.png><link rel=icon sizes=120x120 href=favicon-120x120.png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap"><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/x2js/1.2.0/xml2json.min.js integrity="sha512-HX+/SvM7094YZEKOCtG9EyjRYvK8dKlFhdYAnVCGNxMkA59BZNSZTZrqdDlLXp0O6/NjDb1uKnmutUeuzHb3iQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><style>@import url(https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap);*{font-family:Roboto,Verdana,Arial,Helvetica,sans-serif}body{background-color:#000;color:#e3e3e3;position:absolute;font-size:125%;top:0;bottom:0;left:0;right:0}input[type=text]{height:1.5em;background-color:#c3c3c3;color:#000;font-size:1em;font-weight:700}input[type=button]{height:2em;font-size:125%;font-weight:700;min-width:6em;margin-top:.5em;text-align:center;background-color:#d2691e;color:#e3e3e3}input[type=button]:disabled{background-color:#7e7e7e;opacity:25%}form{text-align:center}h1{text-align:center;margin-top:0}p{margin-top:.25em}.paraHead{font-size:110%;font-weight:700}.run{display:none;height:100%}.config{display:none;height:100%}.notPlaying{display:flex;justify-content:center;align-items:center;height:100%}.notPlaying .timeOfDay{text-align:center;font-size:12em;font-weight:700}.playing{display:flex;align-items:center;height:100%}.playingContainer{display:flex;height:400px;min-width:0}.left{width:400px}.right{display:flex;flex-direction:column;flex:1;margin-left:15px;min-width:0}.bottom{margin-top:auto}.text{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.timeOfDay{display:block;font-size:6em;font-weight:700;line-height:1em}.today{display:block;text-align:center;font-size:2.5em;padding-bottom:.5em}#image{width:400px;height:400px;padding-right:20px}#title1{font-size:3em;font-weight:700}#title2{margin-block-start:.25em;font-size:2em;font-weight:700}#title3{margin-block-start:.25em;font-size:1.5em;font-weight:400}#timeOfDay{padding-top:25px}#serviceIcon{display:block;width:32px;height:32px}#quality,#serviceName,#streamFormat{display:inline;font-size:1em;font-weight:400;margin-right:.25em}#errorMessage{display:none;color:red;margin:.5em auto;text-align:center}#errorMessage p{margin:0;line-height:1.5em}#spinner{display:none;margin:.5em auto}</style><style>.lds-ring{display:inline-block;position:relative;width:64px;height:64px}.lds-ring div{box-sizing:border-box;display:block;position:absolute;width:42px;height:42px;margin:5px;border:5px solid #e3e3e3;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:#e3e3e3 transparent transparent transparent}.lds-ring div:nth-child(1){animation-delay:-.45s}.lds-ring div:nth-child(2){animation-delay:-.3s}.lds-ring div:nth-child(3){animation-delay:-.15s}@keyframes lds-ring{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><script>let config={disableLongPoll:!1,logStatus:!1};async function run(){for(config=await getConfig(config),$("#playing").hide(),$("#notPlaying").show(),$("#run").show(),updateTime(),setInterval(updateTime,1e3);;){try{await updatePlayer()}catch(t){etag=void 0,console.log(t)}await sleep(canLongPoll()?1e3:3e4)}}$(async function(){$("#notPlaying").click(()=>{localStorage.setItem("config",JSON.stringify({priorIP:config.playerIP})),location.reload()}),await run()});let etag;function canLongPoll(){return etag&&config.pollTimeout&&!config.disableLongPoll}async function updatePlayer(){let t="Status";canLongPoll()&&(t+=`?timeout=${config.pollTimeout}&etag=`+etag);var e=(e=await playerRequest(t,{fetchTimeout:canLongPoll()?1e3*config.pollTimeout+1e3:3e4,...config})).status||{};etag=e._etag,config.logStatus&&console.log(e),"play"!==e.state&&"stream"!==e.state?($("#playing").hide(),$("#notPlaying").show()):($("#playing").show(),$("#notPlaying").hide(),setImageSrc($("#image"),e.image,config),$("#title1").html(e.title1||""),$("#title2").html(e.title2||""),$("#title3").html(e.title3||""),setImageSrc($("#serviceIcon"),e.serviceIcon,config),isNaN(e.quality)?e.quality=(e.quality||"").toString().toUpperCase():e.quality=e.quality/1e3+" Kbps","MQAAUTHORED"===e.quality&&(e.quality="MQA (AUTH)"),$("#quality").html(e.quality),$("#streamFormat").html(e.streamFormat||""),$("#timeOfDay").css("fontSize",e.title1&&(e.title2||e.title3)?"6em":"10em"))}function updateTime(){const t=new Date;$(".timeOfDay").each(function(){$(this).html(t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0"))}),$(".today").each(function(){$(this).html(formatDate(t))})}function formatDate(t){var[t,e,a,i]=[t.getDay(),t.getMonth(),t.getDate(),t.getFullYear()];return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t]+` ${["January","February","March","April","May","June","July","August","September","October","November","December"][e]} ${a}, `+i}</script><script>const defaultConfig={playerIP:void 0,pollTimeout:100};async function getConfig(e){var r={...defaultConfig,...e||{},...JSON.parse(localStorage.getItem("config")||"{}")};for(r.priorIP&&$("#ip_address").val(r.priorIP);!r.playerIP;){var t=await getPlayerIP();t&&(r.playerIP=t,localStorage.setItem("config",JSON.stringify({playerIP:r.playerIP})))}return r}async function getPlayerIP(){let e;for(enableButtonIfValidIP("#ip_address","#btnConfig");!e;){$("#config").show();try{$("#btnConfig").show(),$("#spinner").hide();var r=await configButtonClick(),t=($("#errorMessage").hide(),$("#btnConfig").hide(),$("#spinner").show(),await playerRequest("SyncStatus",{...config,playerIP:r,fetchTimeout:1e4,errorMessage:"Error connecting to the player<br>Check the IP address is correct and reachable"}));if(t&&t.SyncStatus){if("true"!==t.SyncStatus._initialized)throw new Error("The player needs to be setup with the BluOS Controller app");e=r}}catch(e){$("#errorMessageText").html(e.message||e.toLocaleString()),$("#errorMessage").show()}return $("#config").hide(),e}}async function configButtonClick(){return new Promise((e,r)=>{$("#btnConfig").click(()=>{e($("#ip_address").val())})})}</script><script>const x2js=new X2JS;function playerRequest(t,l){return new Promise((a,s)=>{var e=_bluosURL(t,l);$.ajax({url:e,type:"get",dataType:"xml",timeout:l.fetchTimeout}).done((e,t,r)=>a(x2js.xml2json(r.responseXML))).fail((e,t,r)=>s(new Error(l.errorMessage||("timeout"===r?"Player request timed out":`Error conmmunicating with the player ${r?"("+r+")":""}<br>Check the IP address is correct and reachable`))))})}function setImageSrc(e,t,r){t?(e.attr("src",_bluosURL(t,r)),e.show()):e.hide()}function _bluosURL(e,t){t=`http://${t.playerIP}:11000/`;return e&&(e.match(/https?:\/\//)?e:t+e.replace(/^\//,""))}function sleep(t){return new Promise(e=>setTimeout(e,t))}function enableButtonIfValidIP(t,r){const a=/\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/;let s=46;$(r).prop("disabled",!a.test($(t).val())),$(t).keypress(e=>{if(8!=e.which&&0!=e.which&&e.which!=s&&(e.which<48||57<e.which))return $(r).prop("disabled",!0),!1}).keyup(()=>{var e=$(t);if(a.test(e.val()))s=0,"."==e.val().substr(e.val().length-1)&&e.val(e.val().slice(0,-1)),4==e.val().split(".").length&&$(r).prop("disabled",!1);else{for($(r).prop("disabled",!0);-1!==e.val().indexOf("..");)e.val(e.val().replace("..","."));s=46}})}</script></head><body><div class=run id=run><div class=notPlaying id=notPlaying><div><div class=timeOfDay></div><div class=today></div></div></div><div class=playing id=playing><div class=playingContainer><div class=left><img id=image></div><div class=right><div class=text id=title1></div><div class=text id=title2></div><div class=text id=title3></div><div class=timeOfDay id=timeOfDay></div><div class=bottom><img id=serviceIcon><div id=quality></div><div id=streamFormat></div></div></div></div></div></div><div class=config id=config><div><h1>BluView - Display for BluOS&trade; Streamers</h1><p>This little web app should run in most modern browsers to continuously display what's playing. It includes the current time since it's handy to also use it as a clock. And when nothing is playing it's just a clock.</p><p><span class=paraHead>Privacy: </span>It runs entirely within your browser and there is no server other than to provide this web page. No data is sent or stored anywhere except it saves the IP address of your streamer within your browser's local storage so you don't have to re-enter it.</p><p><span class=paraHead>Configuration: </span>You only need to configure the IP address of your streamer. You'll find this in the BluOS app under Help -> Diagnostics. You should only need to do this once or if the address changes.</p><form><div><label for=ip_address>Your BluOS streamer's IP Address:</label> <input type=text id=ip_address name=ip_address placeholder="eg. 192.168.1.50"></div><input type=button id=btnConfig value=Configure></form><div class=lds-ring id=spinner><div></div><div></div><div></div><div></div></div><div id=errorMessage><p id=errorMessageText></p></div></div></div></body></html>